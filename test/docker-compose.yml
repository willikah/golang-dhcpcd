services:
  dhcpd:
    image: networkboot/dhcpd:latest
    volumes:
      - ./dhcpd.conf:/data/dhcpd.conf
    networks:
      - dhcp_net
      - static_net
    environment:
      - INTERFACES=eth0
    privileged: true
  
  # First golang-dhcpcd client: DHCP on eth0, Static on eth1
  client-1:
    build:
      context: ..
      dockerfile: Dockerfile
    volumes:
      - ./golang-dhcpcd-1.yml:/app/golang-dhcpcd.yml
    command: ["serve", "-f", "/app/golang-dhcpcd.yml"]
    privileged: true
    cap_add:
      - NET_ADMIN
      - NET_RAW
      - SYS_ADMIN
    networks:
      - dhcp_net
      - static_net

  # Second golang-dhcpcd client: DHCP on eth0, Static on eth1  
  client-2:
    build:
      context: ..
      dockerfile: Dockerfile
    volumes:
      - ./golang-dhcpcd-2.yml:/app/golang-dhcpcd.yml
    command: ["serve", "-f", "/app/golang-dhcpcd.yml"]
    privileged: true
    cap_add:
      - NET_ADMIN
      - NET_RAW
      - SYS_ADMIN
    networks:
      - dhcp_net
      - static_net

networks:
  dhcp_net:
    driver: bridge
    enable_ipv6: false
    ipam:
      config:
        - subnet: 192.168.100.0/24
          gateway: 192.168.100.1
  
  static_net:
    driver: bridge
    enable_ipv6: false
    ipam:
      config:
        - subnet: 192.168.101.0/24
          gateway: 192.168.101.1
